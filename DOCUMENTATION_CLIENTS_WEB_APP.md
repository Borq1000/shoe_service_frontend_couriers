# Документация веб-клиента ShoeMaster

Документация фронтенд-части клиентского веб-приложения для сервиса по ремонту обуви

## 1. Общее описание

ShoeMaster Web Client - это клиентское веб-приложение, разработанное для заказчиков услуг по ремонту и обслуживанию обуви. Построенное на современных веб-технологиях, оно предоставляет интуитивно понятный интерфейс для заказа услуг по ремонту обуви, отслеживания заказов и управления профилем клиента.

## 2. Технический стек

### 2.1 Основные технологии

- **Frontend Framework**: Next.js 14.2.13
- **Язык программирования**: TypeScript
- **Стилизация**: Tailwind CSS
- **Аутентификация**: NextAuth.js 5.0 beta
- **HTTP-клиент**: Axios
- **Управление формами**: React (встроенное управление состоянием)
- **Валидация**: Zod
- **Иконки**: React Icons

### 2.2 Основные зависимости

{
"next": "14.2.13",
"react": "^18",
"next-auth": "5.0.0-beta.22",
"axios": "^1.7.7",
"tailwindcss": "^3.4.1",
"typescript": "^5",
"zod": "^3.23.8"
}

## 3. Архитектура проекта

### 3.1 Структура проекта

app/
├── account/ # Страницы личного кабинета
├── api/ # API-маршруты Next.js
├── orders/ # Страницы управления заказами
├── services/ # Страницы услуг
├── aboutus/ # Информационные страницы
components/ # React-компоненты
actions/ # Серверные действия
schemas/ # Схемы валидации

### 3.2 Ключевые компоненты

- **NavBar**: Навигация и аутентификация
- **ServiceHome**: Отображение доступных услуг
- **Features**: Преимущества сервиса
- **OrdersPage**: Управление заказами
- **ContactInfo**: Контактная информация
- **RegistrationForm**: Регистрация пользователей
- **PasswordResetForm**: Восстановление пароля

## 4. Основной функционал

### 4.1 Аутентификация и авторизация

#### 4.1.1 Основные компоненты

- `auth.ts` - Основная конфигурация NextAuth.js
- `middleware.ts` - Защита маршрутов и обработка редиректов
- `routes.ts` - Определение публичных, защищенных и авторизационных маршрутов

#### 4.1.2 Механизм аутентификации

- Регистрация и вход через email/пароль
- JWT-токены (access и refresh)
- Автоматическое обновление токенов
- Защита маршрутов на уровне middleware
- Обработка истечения сессии
- Сохранение URL возврата после авторизации

#### 4.1.3 Категории маршрутов

1. Публичные маршруты (`publicRoutes`):

   - `/about` - О сервисе
   - `/contact` - Контакты
   - `/faq` - FAQ

2. Маршруты аутентификации (`authRoutes`):

   - `/login` - Вход
   - `/register` - Регистрация
   - `/forgot-password` - Восстановление пароля

3. Защищенные маршруты (`protectedRoutes`):
   - `/` - Главная страница
   - `/profile` - Профиль пользователя
   - `/my-orders` - Мои заказы
   - `/orders` - Управление заказами
   - `/settings` - Настройки

#### 4.1.4 Middleware и редиректы

1. Обработка запросов:

   - Проверка аутентификации для каждого запроса
   - Исключение статических файлов и API-маршрутов из проверки
   - Определение типа маршрута (публичный/защищенный/авторизационный)

2. Логика редиректов:

   - Неавторизованные пользователи перенаправляются на `/login`
   - Сохранение исходного URL в параметре `callbackUrl`
   - Авторизованные пользователи перенаправляются с авторизационных страниц на DEFAULT_LOGIN_REDIRECT
   - Корректная обработка базового URL для редиректов

3. Исключения из проверки middleware:
   - `api/auth/*` - маршруты API аутентификации
   - `_next/static/*` - статические файлы
   - `_next/image/*` - оптимизированные изображения
   - `_next/data/*` - данные Next.js
   - `favicon.ico`
   - `public/*`

#### 4.1.5 Безопасность

- Защита от несанкционированного доступа через middleware
- Автоматический редирект на страницу входа с сохранением исходного URL
- HTTP-only cookies для хранения сессии
- Защита API-маршрутов аутентификации
- Обработка истекших сессий

#### 4.1.6 Переменные окружения

```env
NEXTAUTH_URL=http://localhost:3001      # Базовый URL приложения
NEXTAUTH_SECRET=your-secret-key         # Секретный ключ для JWT
```

### 4.2 Управление заказами

- Создание заказов на ремонт обуви
- Просмотр истории заказов
- Отслеживание статуса заказа
- Добавление комментариев и фотографий к заказам

### 4.3 Статусы заказов

const statusMapping = {
pending: "В ожидании",
awaiting_courier: "Ожидает курьера",
courier_on_the_way: "Курьер в пути",
at_location: "На месте",
in_progress: "В работе",
completed: "Завершён",
cancelled: "Отменён",
return: "Возврат"
};

### 4.4 Профиль пользователя

- Просмотр и редактирование личной информации
- Управление настройками аккаунта
- История заказов

## 5. Интеграция с API

### 5.1 Основные эндпоинты

- `/api/orders/` - Управление заказами
- `/api/services/` - Информация об услугах
- `/authentication/` - Аутентификация и управление профилем
- `/api/send-email-verification/` - Верификация email

### 5.2 Безопасность

- Защита маршрутов через NextAuth.js
- Валидация данных через Zod
- HTTP-only cookies для хранения токенов
- Защита от CSRF-атак

## 6. Пользовательские сценарии

### 6.1 Регистрация и вход

1. Создание аккаунта
2. Подтверждение email
3. Вход в систему
4. Восстановление пароля

### 6.2 Создание заказа

1. Выбор услуги
2. Указание адреса
3. Загрузка фотографий обуви
4. Добавление ��омментариев
5. Подтверждение заказа

### 6.3 Управление заказами

1. Просмотр активных заказов
2. Отслеживание статуса
3. История заказов
4. Отмена заказа

### 6.4 Управление профилем

1. Редактирование личной информации
2. Изменение настроек
3. Просмотр истории

## 7. Рекомендации по разработке

### 7.1 Стиль кода

- Следование лучшим практикам TypeScript
- Использование функциональных компонентов
- Правильная обработка ошибок
- Соблюдение единого стиля именования

### 7.2 Структура компонентов

- Разделение бизнес-логики и UI
- Использование правильных типов
- Валидация props
- Следование лучшим практикам React Hooks

## 8. Развертывание

### 8.1 Требования

- Node.js 18+
- npm или yarn
- Настройка переменных окружения

### 8.2 Процесс сборки

# Установка зависимостей

npm install

# Разработка

npm run dev

# Продакшн сборка

npm run build
npm start

## 9. Переменные окружения

NEXT_PUBLIC_API_URL=http://127.0.0.1:8000
NEXTAUTH_SECRET=your-secret-key
NEXTAUTH_URL=http://localhost:3000

## 10. Участие в разработке

1. Следование модели ветвления Git flow
2. Написание осмысленных сообщений коммитов
3. Документирование новых функций
4. Обновление тестов при необходимости

## 11. Поддержка

По техническим вопросам обращаться:

- Email: support@shoemaster.com
- Технический руководитель: [контактная информация]

---

Последнее обновление: [Текущая дата]
Версия: 1.0.0
